Создание БД

CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(100),
    email VARCHAR(150),
    role VARCHAR(20)
);

CREATE TABLE player_profiles (
    player_id INT PRIMARY KEY REFERENCES users(user_id),
    registration_date DATE,
    rated_games INT DEFAULT 0,
    reviews_written INT DEFAULT 0,
    favorite_genres_count INT DEFAULT 0,
    favorite_games_count INT DEFAULT 0
);

CREATE TABLE developer_profiles (
    developer_id INT PRIMARY KEY REFERENCES users(user_id),
    company_name VARCHAR(200)
);

CREATE TABLE games (
    game_id SERIAL PRIMARY KEY,
    developer_id INT REFERENCES users(user_id),
    title VARCHAR(200),
    description TEXT,
    system_requirements TEXT
);

CREATE TABLE genres (
    genre_id SERIAL PRIMARY KEY,
    name VARCHAR(100)
);

CREATE TABLE reviews (
    review_id SERIAL PRIMARY KEY,
    game_id INT REFERENCES games(game_id),
    player_id INT REFERENCES users(user_id),
    rating INT,
    comment TEXT,
    moderation_status VARCHAR(20)
);

CREATE TABLE activity_logs (
    log_id BIGSERIAL PRIMARY KEY,
    user_id INT REFERENCES users(user_id),
    event_type VARCHAR(100),
    target_game_id INT REFERENCES games(game_id),
    created_at TIMESTAMP
);

CREATE TABLE game_analytics (
    game_id INT PRIMARY KEY REFERENCES games(game_id),
    average_rating DECIMAL,
    total_reviews INT,
    total_views INT,
    last_updated TIMESTAMP
);

CREATE TABLE game_genres (
    game_id INT REFERENCES games(game_id),
    genre_id INT REFERENCES genres(genre_id),
    PRIMARY KEY (game_id, genre_id)
);

CREATE TABLE player_genre_prefs (
    player_id INT REFERENCES users(user_id),
    genre_id INT REFERENCES genres(genre_id),
    weight INT,
    PRIMARY KEY (player_id, genre_id)
);


Тестовые данные

INSERT INTO users (username, email, role) VALUES
('Игрок1', 'player1@mail.ru', 'player'),
('Игрок2', 'player2@mail.ru', 'player'),
('Разработчик1', 'dev1@mail.ru', 'dev'),
('Менеджер1', 'manager1@mail.ru', 'manager');

INSERT INTO player_profiles (player_id, registration_date, rated_games, reviews_written, favorite_genres_count, favorite_games_count)
VALUES
(1, '2023-01-10', 27, 8, 12, 14),
(2, '2023-05-20', 10, 2, 5, 3);

INSERT INTO developer_profiles (developer_id, company_name)
VALUES
(3, 'CDPR');

INSERT INTO genres (name) VALUES
('RPG'), ('Шутер'), ('Стратегия'), ('Инди');

INSERT INTO games (developer_id, title, description, system_requirements)
VALUES
(3, 'The Witcher 3', 'Фэнтези RPG', '8GB RAM, GTX 960'),
(3, 'CyberPunk', 'Космический шутер', '16GB RAM, GTX 2060');

INSERT INTO reviews (game_id, player_id, rating, comment, moderation_status)
VALUES
(1, 1, 5, 'Отличная RPG!', 'approved'),
(2, 2, 4, 'Хороший шутер', 'approved');

INSERT INTO game_genres VALUES
(1, 1), (1, 3), (2, 2);

INSERT INTO player_genre_prefs VALUES
(1, 1, 10), (1, 3, 8), (2, 2, 9);


Основные SQL‑запросы

1. Получить топ‑игры по рейтингу

SELECT g.title, AVG(r.rating) AS avg_rating
FROM games g
JOIN reviews r ON g.game_id = r.game_id
GROUP BY g.title
ORDER BY avg_rating DESC;


2. Получить профиль игрока со статистикой

SELECT u.username, p.*
FROM users u
JOIN player_profiles p ON u.user_id = p.player_id
WHERE u.user_id = 1;


3. Получить все игры разработчика

SELECT g.title
FROM games g
JOIN users u ON g.developer_id = u.user_id
WHERE u.username = 'Разработчик1';


4. Получить жанры игры

SELECT ge.name
FROM genres ge
JOIN game_genres gg ON ge.genre_id = gg.genre_id
WHERE gg.game_id = 1;


5. Логи активности пользователя

SELECT event_type, created_at
FROM activity_logs
WHERE user_id = 4
ORDER BY created_at DESC;

